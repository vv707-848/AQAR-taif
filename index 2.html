<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>منصّة عقارك - الصفحة الرئيسية</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- خط Cairo -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <!-- Bootstrap CSS (نسخة RTL) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- أيقونات Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    :root {
      /* الخط الأساسي */
      --font-family: 'Cairo', sans-serif;
      
      /* الألوان الأساسية */
      --primary-color: #0f4c81; /* لون رئيسي أزرق داكن */
      --primary-light: #e8f1f8;
      --primary-dark: #0a3a5c;
      --secondary-color: #f5f7fa;
      --accent-color: #22b573; /* لون أخضر أكثر إشراقًا */
      --accent-light: #e6f8f0;
      --accent-dark: #17864d;
      
      /* ألوان النصوص والحدود */
      --dark-text: #344767;
      --light-text: #667085;
      --border-color: #e1e8ee;
      
      /* ألوان إضافية للاستخدام في الواجهة */
      --purple: #9b59b6;
      --warning: #f39c12;
      --info: #3498db;
      --danger: #e74c3c;
      --success: #22b573;
      
    /* كلاسات للألوان */
    .text-purple { color: var(--purple) !important; }
    .text-warning { color: var(--warning) !important; }
    .text-info { color: var(--info) !important; }
    .text-danger { color: var(--danger) !important; }
    .text-success { color: var(--success) !important; }
      
      /* ألوان الهيدر */
      --header-gradient: linear-gradient(135deg, #0f4c81, #154c75);
      --header-text-color: #fff;
      
      /* ألوان شارات العقارات */
      --featured-badge: #ff9500;
      --exclusive-badge: #8a2be2;
      --new-badge: #22b573;
      --type-sale-badge: #4caf50;
      --type-rent-badge: #2196f3;
      
      /* ألوان العقارات والبطاقات */
      --property-overlay-gradient: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.6));
      --property-feature-separator: rgba(0,0,0,0.1);
      --property-feature-highlight: rgba(34, 181, 115, 0.1);
      --property-footer-bg: rgba(245, 247, 250, 0.7);
      
      /* تأثيرات الأزرار */
      --btn-glow-primary: rgba(15, 76, 129, 0.25);
      --btn-glow-accent: rgba(34, 181, 115, 0.25);
      --btn-glow-whatsapp: rgba(37, 211, 102, 0.25);
      --btn-hover-effect: rgba(255, 255, 255, 0.15);
      
      /* أنماط الحواف والظلال والتأثيرات العامة */
      --radius-sm: 6px;
      --radius: 12px;
      --radius-lg: 20px;
      --shadow-sm: 0 2px 6px rgba(0,0,0,0.05);
      --shadow: 0 5px 15px rgba(0,0,0,0.08);
      --shadow-lg: 0 10px 25px rgba(15,76,129,0.12);
      --transition: all 0.35s ease;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: var(--font-family);
      background-color: var(--secondary-color);
      margin: 0;
      padding-top: 80px;
      color: var(--dark-text);
      line-height: 1.6;
    }
    
    /* ====== الهيدر وشريط التنقل ====== */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--header-gradient);
      padding: 10px 0;
      box-shadow: var(--shadow);
      z-index: 1100;
      color: var(--header-text-color);
    }
    
    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
    }
    
    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon-container {
      width: 40px;
      height: 40px;
      background: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    
    .header-logo-icon {
      font-size: 1.4rem;
      color: var(--primary-color);
    }
    
    .header-container h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(to right, #ffffff, #e0e8f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .header-buttons {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .login-btn {
      background-color: #fff;
      color: var(--primary-color);
      border: none;
      border-radius: 50px;
      padding: 8px 18px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
      box-shadow: var(--shadow);
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,255,255,0.2);
      background-color: #f8f9fa;
    }
    
    .login-btn:active {
      transform: translateY(0);
    }
    
    .search-btn {
      background-color: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      border-radius: 50px;
      padding: 8px 18px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.95rem;
    }
    
    .search-btn:hover {
      background-color: rgba(255,255,255,0.25);
    }
    
    #visitorCount {
      font-size: 0.85rem;
      background: rgba(255,255,255,0.1);
      padding: 5px 15px;
      border-radius: 50px;
      display: flex;
      align-items: center;
      gap: 5px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    /* ====== لوحة تسجيل الدخول ====== */
    #loginPanel {
      display: none;
      position: fixed;
      top: 85px;
      right: 20px;
      width: 320px;
      background: #fff;
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow-lg);
      z-index: 2000;
      border: 1px solid var(--border-color);
    }
    
    #loginPanel h5 {
      color: var(--primary-color);
      font-weight: 700;
      margin-bottom: 25px;
      text-align: center;
      font-size: 1.3rem;
      position: relative;
      padding-bottom: 10px;
    }
    
    #loginPanel h5::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 3px;
      background-color: var(--accent-color);
      border-radius: 3px;
    }
    
    /* ====== صفحة الإدارة ====== */
    #adminPanel {
      display: none;
      background: #fff;
      padding: 30px;
      border-radius: var(--radius);
      max-width: 1200px;
      margin: 0 auto 40px;
      box-shadow: var(--shadow);
    }
    
    .nav-tabs .nav-link {
      color: var(--light-text);
      border: none;
      font-weight: 600;
      padding: 12px 20px;
      border-radius: var(--radius-sm);
    }
    
    .nav-tabs .nav-link.active {
      color: var(--primary-color);
      background-color: var(--primary-light);
      border-bottom: 3px solid var(--primary-color);
    }
    
    .nav-tabs .nav-link i {
      margin-right: 8px;
      color: inherit;
    }
    
    /* ====== عناصر النموذج ====== */
    .form-control, .form-select {
      padding: 12px 18px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
      transition: var(--transition);
      color: var(--dark-text);
      font-size: 0.95rem;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(15, 76, 129, 0.1);
    }
    
    .form-label {
      font-weight: 600;
      color: var(--dark-text);
      margin-bottom: 10px;
    }
    
    /* ====== قسم الرئيسية (Hero) ====== */
    .hero-section {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #fff;
      background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1515263487990-61b07816b324?w=1600&auto=format') center/cover no-repeat;
      min-height: 500px;
      margin-top: 0;
      margin-bottom: 30px;
      clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
      overflow: visible;
    }
    
    .hero-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    .hero-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
      padding: 20px;
    }
    
    .hero-content h2 {
      font-size: 2.8rem;
      margin-bottom: 15px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      line-height: 1.2;
    }
    
    .hero-content p {
      font-size: 1.3rem;
      margin-bottom: 20px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    /* ====== قسم البحث المتقدم ====== */
    .search-box {
      background: #fff;
      border-radius: var(--radius);
      padding: 25px;
      margin-top: -80px;
      position: relative;
      z-index: 10;
      box-shadow: var(--shadow-lg);
      margin-bottom: 40px;
    }
    
    .search-box-title {
      margin-bottom: 20px;
      font-weight: 700;
      color: var(--primary-color);
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .search-box-title i {
      color: var(--accent-color);
    }
    
    .search-advanced-toggle {
      color: var(--primary-color);
      background-color: var(--primary-light);
      border: none;
      font-size: 0.9rem;
      padding: 8px 15px;
      border-radius: 50px;
      transition: var(--transition);
    }
    
    .search-advanced-toggle:hover {
      background-color: var(--primary-color);
      color: #fff;
    }
    
    /* ====== البحث خيار الأقسام ====== */
    .category-title {
      color: var(--dark-text);
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
      position: relative;
    }
    
    .categories-slider {
      overflow-x: auto;
      white-space: nowrap;
      padding: 15px 0;
      -ms-overflow-style: none;
      scrollbar-width: none;
      margin-bottom: 30px;
      display: flex;
    }
    
    .categories-slider::-webkit-scrollbar {
      display: none;
    }
    
    .category-card {
      background: #fff;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 15px 10px;
      min-width: 120px;
      margin-right: 15px;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      box-shadow: var(--shadow-sm);
    }
    
    .category-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow);
    }
    
    .category-card.active {
      background-color: var(--primary-light);
      border-color: var(--primary-color);
      box-shadow: 0 5px 15px rgba(15, 76, 129, 0.15);
    }
    
    .category-card.active .category-icon {
      color: var(--primary-color);
      background-color: #fff;
    }
    
    .category-card.active .category-text {
      color: var(--primary-color);
      font-weight: 700;
    }
    
    .category-icon {
      font-size: 1.5rem;
      color: var(--light-text);
      margin-bottom: 8px;
      width: 50px;
      height: 50px;
      background-color: var(--secondary-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .category-text {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--dark-text);
      margin: 0;
      white-space: normal;
      text-align: center;
    }
    
    /* ====== قائمة العقارات ====== */
    .properties-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .property-list-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--dark-text);
      margin-bottom: 0;
    }
    
    .properties-count {
      background-color: var(--primary-light);
      color: var(--primary-color);
      font-weight: 600;
      padding: 5px 15px;
      border-radius: 50px;
      font-size: 0.9rem;
    }
    
    #loadingProperties {
      text-align: center;
      margin: 30px 0;
      font-size: 1.1rem;
      color: var(--light-text);
      padding: 25px;
      border-radius: var(--radius);
    }
    
    /* ====== بطاقة العقار ====== */
    .property-card {
      border: none;
      border-radius: var(--radius);
      overflow: hidden;
      background: #fff;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    /* تنسيق خاص للعقارات المميزة */
    .featured-property {
      border: 2px solid var(--featured-badge) !important;
      box-shadow: 0 5px 20px rgba(255, 149, 0, 0.2) !important;
      transform: translateY(-5px);
      position: relative;
      z-index: 10;
      transition: all 0.3s ease;
      animation: featuredPulse 2s infinite;
    }
    
    @keyframes featuredPulse {
      0% { box-shadow: 0 5px 20px rgba(255, 149, 0, 0.15); }
      50% { box-shadow: 0 8px 25px rgba(255, 149, 0, 0.35); }
      100% { box-shadow: 0 5px 20px rgba(255, 149, 0, 0.15); }
    }
    
    /* تنسيق خاص للعروض الحصرية */
    .exclusive-property {
      border: 2px solid var(--exclusive-badge) !important;
      box-shadow: 0 5px 20px rgba(138, 43, 226, 0.2) !important;
      transform: translateY(-5px);
      position: relative;
      z-index: 10;
      transition: all 0.3s ease;
      animation: exclusivePulse 2s infinite;
    }
    
    @keyframes exclusivePulse {
      0% { box-shadow: 0 5px 20px rgba(138, 43, 226, 0.15); }
      50% { box-shadow: 0 8px 25px rgba(138, 43, 226, 0.35); }
      100% { box-shadow: 0 5px 20px rgba(138, 43, 226, 0.15); }
    }
    
    .property-card:hover {
      transform: translateY(-10px);
      box-shadow: var(--shadow-lg);
    }
    
    .property-image-container {
      position: relative;
      width: 100%;
      overflow: hidden;
      height: 220px;
    }
    
    .property-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: var(--transition);
    }
    
    .property-card:hover .property-image {
      transform: scale(1.1);
    }
    
    .property-badges {
      position: absolute;
      top: 15px;
      left: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      z-index: 10;
    }
    
    .property-badge {
      background-color: rgba(255, 255, 255, 0.9);
      color: var(--dark-text);
      font-size: 0.8rem;
      font-weight: 600;
      padding: 5px 10px;
      border-radius: 50px;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .property-badge.featured {
      background-color: var(--featured-badge);
      color: #fff;
      animation: pulse 2s infinite;
      box-shadow: 0 3px 10px rgba(255, 149, 0, 0.4);
      font-weight: 700;
    }
    
    .property-badge.exclusive {
      background-color: var(--exclusive-badge);
      color: #fff;
      box-shadow: 0 3px 10px rgba(142, 68, 173, 0.4);
      font-weight: 700;
    }
    
    .property-badge.new {
      background-color: var(--new-badge);
      color: #fff;
      box-shadow: 0 3px 10px rgba(46, 204, 113, 0.4);
      font-weight: 700;
    }
    
    .property-badge.sale {
      background-color: var(--type-sale-badge);
      color: #fff;
    }
    
    .property-badge.rent {
      background-color: var(--type-rent-badge);
      color: #fff;
    }
    
    .property-type {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--property-overlay-gradient);
      padding: 20px 15px 15px;
      color: #fff;
      z-index: 5;
    }
    
    .property-type-label {
      font-size: 0.9rem;
      font-weight: 600;
      margin: 0;
    }
    
    .property-price {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      line-height: 1.2;
    }
    
    .property-content {
      padding: 20px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }
    
    .property-title {
      color: var(--dark-text);
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 8px;
      line-height: 1.3;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .property-location {
      color: var(--light-text);
      font-size: 0.95rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .property-description {
      color: var(--dark-text);
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 20px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      line-height: 1.6;
      background-color: rgba(242, 246, 249, 0.7);
      padding: 12px;
      border-radius: var(--radius-sm);
      border-right: 3px solid var(--primary-color);
    }
    
    .property-features {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: auto;
      padding-top: 15px;
      border-top: 1px solid var(--property-feature-separator);
    }
    
    .property-feature {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--light-text);
      gap: 5px;
      font-size: 0.9rem;
    }
    
    .property-feature-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background-color: var(--property-feature-highlight);
      border-radius: 50%;
      color: var(--accent-color);
      font-size: 0.85rem;
    }
    
    .property-feature-text {
      font-weight: 600;
      color: var(--dark-text);
    }
    
    .property-footer {
      background-color: var(--property-footer-bg);
      backdrop-filter: blur(5px);
      padding: 12px 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .property-age {
      font-size: 0.85rem;
      color: var(--light-text);
    }
    
    .property-contact {
      display: flex;
      gap: 10px;
    }
    
    .whatsapp-btn, .call-btn {
      width: 36px;
      height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 1.1rem;
      transition: var(--transition);
      border: none;
      cursor: pointer;
    }
    
    .whatsapp-btn {
      background-color: #25d366;
      color: white;
      box-shadow: 0 3px 10px var(--btn-glow-whatsapp);
    }
    
    .whatsapp-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px var(--btn-glow-whatsapp);
    }
    
    .call-btn {
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 3px 10px var(--btn-glow-primary);
    }
    
    .call-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px var(--btn-glow-primary);
    }
    
    /* ====== الأزرار الرئيسية ====== */
    .btn-primary {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      box-shadow: 0 5px 15px var(--btn-glow-primary);
      transition: var(--transition);
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 50px;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px var(--btn-glow-primary);
    }
    
    .btn-primary:active {
      transform: translateY(-1px);
    }
    
    .btn-success {
      background-color: var(--accent-color);
      color: #fff;
      border: none;
      box-shadow: 0 5px 15px var(--btn-glow-accent);
      transition: var(--transition);
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 50px;
    }
    
    .btn-success:hover {
      background-color: var(--accent-dark);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px var(--btn-glow-accent);
    }
    
    .btn-success:active {
      transform: translateY(-1px);
    }
    
    /* ====== مقطع الفوتر ====== */
    .footer {
      background: var(--primary-color);
      padding: 50px 0 30px;
      margin-top: 50px;
      color: rgba(255, 255, 255, 0.8);
      position: relative;
      overflow: hidden;
    }
    
    .footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(15, 76, 129, 0.8) 0%, rgba(15, 76, 129, 0.1) 100%);
      z-index: 1;
    }
    
    .footer-container {
      position: relative;
      z-index: 2;
    }
    
    .footer h4 {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: white;
      position: relative;
      padding-bottom: 10px;
    }
    
    .footer h4::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 40px;
      height: 3px;
      background-color: var(--accent-color);
      border-radius: 3px;
    }
    
    .footer-links {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .footer-links li {
      margin-bottom: 10px;
    }
    
    .footer-links a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: var(--transition);
      display: inline-block;
    }
    
    .footer-links a:hover {
      color: white;
      transform: translateX(-5px);
    }
    
    .footer-links i {
      margin-left: 8px;
      color: var(--accent-color);
    }
    
    .footer-social {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .social-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: white;
      text-decoration: none;
      transition: var(--transition);
    }
    
    .social-icon:hover {
      background-color: white;
      color: var(--primary-color);
      transform: translateY(-5px);
    }
    
    .footer-bottom {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      font-size: 0.9rem;
    }
    
    /* ====== تصميم متجاوب ====== */
    @media (max-width: 768px) {
      .hero-content h2 {
        font-size: 2rem;
      }
      
      .hero-content p {
        font-size: 1.1rem;
      }
      
      .search-box {
        margin-top: -40px;
        padding: 20px;
      }
      
      .property-image-container {
        height: 180px;
      }
      
      .property-card {
        margin-bottom: 20px;
      }
      
      .footer {
        padding: 40px 0 20px;
      }
      
      .footer-col {
        margin-bottom: 30px;
      }
    }
    
    /* ====== تأثيرات إضافية ====== */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
  </style>
</head>
<body>

  <!-- هيدر الموقع -->
  <header class="header">
    <div class="header-container">
      <div class="header-logo">
        <div class="logo-icon-container">
          <i class="bi bi-house-door-fill header-logo-icon"></i>
        </div>
        <h1>منصّة عقارك</h1>
      </div>
      <div class="header-buttons">
        <span id="visitorCount">
          <i class="bi bi-eye"></i>
          <span id="visitorCountNumber">12.5K</span> زائر
        </span>
        <button class="search-btn" id="searchToggle">
          <i class="bi bi-search"></i>
          بحث
        </button>
        <button class="login-btn" id="loginToggle">
          <i class="bi bi-person-fill"></i>
          تسجيل الدخول
        </button>
      </div>
    </div>
  </header>

  <!-- لوحة تسجيل الدخول -->
  <div id="loginPanel">
    <h5>تسجيل الدخول للوحة التحكم</h5>
    <form id="loginForm">
      <div class="mb-3">
        <label for="username" class="form-label">اسم المستخدم</label>
        <input type="text" class="form-control" id="username" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">كلمة المرور</label>
        <input type="password" class="form-control" id="password" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">دخول</button>
    </form>
  </div>

  <!-- قسم الرئيسية (Hero) -->
  <section class="hero-section">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h2>ابحث عن منزل أحلامك في الطائف</h2>
      <p>منصة عقارك توفر لك أفضل العقارات واختيارات سكنية متنوعة في الطائف</p>
    </div>
  </section>

  <div class="container">
    <!-- قسم البحث المتقدم -->
    <div class="search-box" id="searchBox">
      <div class="search-box-title">
        <i class="bi bi-funnel"></i>
        بحث متقدم
      </div>
      <form id="searchForm">
        <div class="row mb-3">
          <div class="col-md-4 mb-3 mb-md-0">
            <label for="propertyType" class="form-label">نوع العقار</label>
            <select class="form-select" id="propertyType">
              <option value="" selected>جميع الأنواع</option>
              <option value="apartment">شقة</option>
              <option value="villa">فيلا</option>
              <option value="land">أرض</option>
              <option value="commercial">تجاري</option>
              <option value="farm">مزرعة</option>
            </select>
          </div>
          <div class="col-md-4 mb-3 mb-md-0">
            <label for="purpose" class="form-label">الغرض</label>
            <select class="form-select" id="purpose">
              <option value="" selected>بيع / إيجار</option>
              <option value="sale">للبيع</option>
              <option value="rent">للإيجار</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="district" class="form-label">الحي</label>
            <select class="form-select" id="district">
              <option value="" selected>جميع الأحياء</option>
              <option value="shifa">الشفا</option>
              <option value="radf">الردف</option>
              <option value="faisaliah">الفيصلية</option>
              <option value="hawiyah">الحوية</option>
              <option value="salamah">السلامة</option>
              <option value="nakheel">النخيل</option>
              <option value="wahaPlaza">واحة الطائف</option>
              <option value="qimatTaif">قمة الطائف</option>
              <option value="rayyan">الريان</option>
              <option value="masarrah">المسرة</option>
              <option value="other">أخرى</option>
            </select>
          </div>
        </div>
        
        <div id="advancedSearchOptions" style="display: none;">
          <div class="row mb-3">
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="minPrice" class="form-label">السعر من</label>
              <input type="number" class="form-control" id="minPrice" placeholder="أقل سعر">
            </div>
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="maxPrice" class="form-label">إلى</label>
              <input type="number" class="form-control" id="maxPrice" placeholder="أعلى سعر">
            </div>
            <div class="col-md-4">
              <label for="bedrooms" class="form-label">عدد الغرف</label>
              <select class="form-select" id="bedrooms">
                <option value="" selected>الكل</option>
                <option value="studio">استوديو</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5+">5+</option>
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="bathrooms" class="form-label">دورات المياه</label>
              <select class="form-select" id="bathrooms">
                <option value="" selected>الكل</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4+">4+</option>
              </select>
            </div>
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="area" class="form-label">المساحة (م²)</label>
              <input type="number" class="form-control" id="area" placeholder="المساحة">
            </div>
            <div class="col-md-4">
              <label for="age" class="form-label">عمر العقار</label>
              <select class="form-select" id="age">
                <option value="" selected>الكل</option>
                <option value="new">جديد</option>
                <option value="0-5">0-5 سنوات</option>
                <option value="5-10">5-10 سنوات</option>
                <option value="10+">أكثر من 10 سنوات</option>
              </select>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-12">
              <label for="keywords" class="form-label">كلمات دلالية</label>
              <input type="text" class="form-control" id="keywords" placeholder="مثال: مدخل خاص، مسبح، مطبخ مفتوح">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 d-grid mb-3 mb-md-0">
            <button type="button" class="search-advanced-toggle" id="advancedSearchToggle">
              <i class="bi bi-plus-circle"></i>
              خيارات متقدمة
            </button>
          </div>
          <div class="col-md-6 d-grid">
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-search"></i>
              بحث
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- الأقسام والتصنيفات -->
    <h3 class="category-title mb-4">تصفح حسب النوع</h3>
    <div class="categories-slider">
      <div class="category-card active" data-category="all">
        <div class="category-icon">
          <i class="bi bi-house"></i>
        </div>
        <span class="category-text">الكل</span>
      </div>
      <div class="category-card" data-category="apartment">
        <div class="category-icon">
          <i class="bi bi-building"></i>
        </div>
        <span class="category-text">شقق</span>
      </div>
      <div class="category-card" data-category="villa">
        <div class="category-icon">
          <i class="bi bi-house-door"></i>
        </div>
        <span class="category-text">فلل</span>
      </div>
      <div class="category-card" data-category="land">
        <div class="category-icon">
          <i class="bi bi-bounding-box"></i>
        </div>
        <span class="category-text">أراضي</span>
      </div>
      <div class="category-card" data-category="commercial">
        <div class="category-icon">
          <i class="bi bi-shop"></i>
        </div>
        <span class="category-text">تجاري</span>
      </div>
      <div class="category-card" data-category="farm">
        <div class="category-icon">
          <i class="bi bi-tree"></i>
        </div>
        <span class="category-text">مزارع</span>
      </div>
      <div class="category-card" data-category="project">
        <div class="category-icon">
          <i class="bi bi-buildings"></i>
        </div>
        <span class="category-text">مشاريع</span>
      </div>
    </div>

    <!-- قائمة العقارات -->
    <div class="properties-header">
      <h3 class="property-list-title">العقارات المميزة</h3>
      <span class="properties-count">20 عقار</span>
    </div>

    <div id="loadingProperties">
      <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">جار التحميل...</span>
        </div>
      </div>
      <p class="mt-3">جار تحميل العقارات...</p>
    </div>

    <!-- قائمة العقارات -->
    <div class="row" id="propertyList">
      <!-- سيتم إضافة العقارات هنا بواسطة JavaScript -->
    </div>

    <!-- لوحة الإدارة -->
    <div id="adminPanel">
      <ul class="nav nav-tabs" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="add-property-tab" data-bs-toggle="tab" data-bs-target="#add-property" type="button" role="tab" aria-controls="add-property" aria-selected="true">
            <i class="bi bi-plus-circle"></i>
            إضافة عقار
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="manage-properties-tab" data-bs-toggle="tab" data-bs-target="#manage-properties" type="button" role="tab" aria-controls="manage-properties" aria-selected="false">
            <i class="bi bi-list-ul"></i>
            إدارة العقارات
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="add-project-tab" data-bs-toggle="tab" data-bs-target="#add-project" type="button" role="tab" aria-controls="add-project" aria-selected="false">
            <i class="bi bi-buildings"></i>
            إضافة مشروع عقاري
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="featured-properties-tab" data-bs-toggle="tab" data-bs-target="#featured-properties" type="button" role="tab" aria-controls="featured-properties" aria-selected="false">
            <i class="bi bi-star"></i>
            العقارات المميزة
          </button>
        </li>
      </ul>
      
      <div class="tab-content mt-4" id="adminTabContent">
        <!-- قسم إضافة عقار -->
        <div class="tab-pane fade show active" id="add-property" role="tabpanel" aria-labelledby="add-property-tab">
          <h4 class="mb-4">إضافة عقار جديد</h4>
          <form id="addPropertyForm">
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="propTitle" class="form-label">عنوان العقار *</label>
                <input type="text" class="form-control" id="propTitle" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propType" class="form-label">نوع العقار *</label>
                <select class="form-select" id="propType" required>
                  <option value="" disabled selected>اختر نوع العقار</option>
                  <option value="apartment">شقة</option>
                  <option value="villa">فيلا</option>
                  <option value="land">أرض</option>
                  <option value="commercial">تجاري</option>
                  <option value="farm">مزرعة</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propPurpose" class="form-label">الغرض *</label>
                <select class="form-select" id="propPurpose" required>
                  <option value="" disabled selected>اختر الغرض</option>
                  <option value="sale">للبيع</option>
                  <option value="rent">للإيجار</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propPrice" class="form-label">السعر *</label>
                <input type="number" class="form-control" id="propPrice" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propDistrict" class="form-label">الحي *</label>
                <select class="form-select" id="propDistrict" required onchange="checkOtherDistrict()">
                  <option value="" disabled selected>اختر الحي</option>
                  <option value="shifa">الشفا</option>
                  <option value="radf">الردف</option>
                  <option value="faisaliah">الفيصلية</option>
                  <option value="hawiyah">الحوية</option>
                  <option value="salamah">السلامة</option>
                  <option value="nakheel">النخيل</option>
                  <option value="wahaPlaza">واحة الطائف</option>
                  <option value="qimatTaif">قمة الطائف</option>
                  <option value="rayyan">الريان</option>
                  <option value="masarrah">المسرة</option>
                  <option value="other">أخرى</option>
                </select>
                <div id="otherDistrictContainer" style="display: none;" class="mt-2">
                  <input type="text" class="form-control" id="otherDistrict" placeholder="أدخل اسم الحي">
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propArea" class="form-label">المساحة (م²) *</label>
                <input type="number" class="form-control" id="propArea" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propBedrooms" class="form-label">عدد الغرف</label>
                <select class="form-select" id="propBedrooms">
                  <option value="" selected>اختر عدد الغرف</option>
                  <option value="studio">استوديو</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5+">5+</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propBathrooms" class="form-label">دورات المياه</label>
                <select class="form-select" id="propBathrooms">
                  <option value="" selected>اختر عدد دورات المياه</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4+">4+</option>
                </select>
              </div>
              <div class="col-md-12 mb-3">
                <label for="propImage" class="form-label">صورة العقار *</label>
                <input type="text" class="form-control" id="propImage" placeholder="رابط الصورة" required>
                <small class="text-muted">يرجى إضافة رابط صورة العقار من الانترنت</small>
              </div>
              <div class="col-md-12 mb-3">
                <label for="propDescription" class="form-label">وصف العقار *</label>
                <textarea class="form-control" id="propDescription" rows="4" required></textarea>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propContact" class="form-label">رقم التواصل *</label>
                <input type="tel" class="form-control" id="propContact" value="0535342404" readonly required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="propWhatsapp" class="form-label">رقم الواتساب (اختياري)</label>
                <input type="tel" class="form-control" id="propWhatsapp" value="0535342404" readonly>
              </div>
            </div>
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="propIsNew">
                <label class="form-check-label" for="propIsNew">عقار جديد</label>
              </div>
            </div>
            <button type="submit" class="btn btn-success mb-3">
              <i class="bi bi-plus-circle"></i>
              إضافة العقار
            </button>
          </form>
        </div>

        <!-- قسم إدارة العقارات -->
        <div class="tab-pane fade" id="manage-properties" role="tabpanel" aria-labelledby="manage-properties-tab">
          <h4 class="mb-4">إدارة العقارات</h4>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>العنوان</th>
                  <th>النوع</th>
                  <th>السعر</th>
                  <th>الحي</th>
                  <th>تاريخ النشر</th>
                  <th>الإجراءات</th>
                </tr>
              </thead>
              <tbody id="propertiesTableBody">
                <!-- سيتم إضافة الصفوف ديناميكيًا -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- قسم إضافة مشروع عقاري -->
        <div class="tab-pane fade" id="add-project" role="tabpanel" aria-labelledby="add-project-tab">
          <h4 class="mb-4">إضافة مشروع عقاري جديد</h4>
          <form id="addProjectForm">
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="projectTitle" class="form-label">اسم المشروع *</label>
                <input type="text" class="form-control" id="projectTitle" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectDeveloper" class="form-label">المطور العقاري *</label>
                <input type="text" class="form-control" id="projectDeveloper" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectLocation" class="form-label">الموقع *</label>
                <select class="form-select" id="projectLocation" required>
                  <option value="" disabled selected>اختر الحي</option>
                  <option value="shifa">الشفا</option>
                  <option value="radf">الردف</option>
                  <option value="faisaliah">الفيصلية</option>
                  <option value="hawiyah">الحوية</option>
                  <option value="salamah">السلامة</option>
                  <option value="nakheel">النخيل</option>
                  <option value="wahaPlaza">واحة الطائف</option>
                  <option value="qimatTaif">قمة الطائف</option>
                  <option value="rayyan">الريان</option>
                  <option value="masarrah">المسرة</option>
                  <option value="other">أخرى</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectType" class="form-label">نوع المشروع *</label>
                <select class="form-select" id="projectType" required>
                  <option value="" disabled selected>اختر نوع المشروع</option>
                  <option value="residential">سكني</option>
                  <option value="commercial">تجاري</option>
                  <option value="mixed">متعدد الاستخدامات</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectUnits" class="form-label">عدد الوحدات *</label>
                <input type="number" class="form-control" id="projectUnits" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectStartPrice" class="form-label">سعر يبدأ من *</label>
                <input type="number" class="form-control" id="projectStartPrice" required>
              </div>
              <div class="col-md-12 mb-3">
                <label for="projectImage" class="form-label">صورة المشروع *</label>
                <input type="text" class="form-control" id="projectImage" placeholder="رابط الصورة" required>
                <small class="text-muted">يرجى إضافة رابط صورة المشروع من الانترنت</small>
              </div>
              <div class="col-md-12 mb-3">
                <label for="projectDescription" class="form-label">وصف المشروع *</label>
                <textarea class="form-control" id="projectDescription" rows="4" required></textarea>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectStatus" class="form-label">حالة المشروع *</label>
                <select class="form-select" id="projectStatus" required>
                  <option value="" disabled selected>اختر حالة المشروع</option>
                  <option value="planned">تخطيط</option>
                  <option value="underConstruction">قيد الإنشاء</option>
                  <option value="completed">مكتمل</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectCompletionDate" class="form-label">تاريخ الانتهاء المتوقع</label>
                <input type="date" class="form-control" id="projectCompletionDate">
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectContact" class="form-label">رقم التواصل *</label>
                <input type="tel" class="form-control" id="projectContact" value="0535342404" readonly required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="projectWebsite" class="form-label">الموقع الإلكتروني (اختياري)</label>
                <input type="url" class="form-control" id="projectWebsite" placeholder="https://example.com">
              </div>
            </div>
            <button type="submit" class="btn btn-success mb-3">
              <i class="bi bi-plus-circle"></i>
              إضافة المشروع
            </button>
          </form>
        </div>

        <!-- قسم العقارات المميزة -->
        <div class="tab-pane fade" id="featured-properties" role="tabpanel" aria-labelledby="featured-properties-tab">
          <h4 class="mb-4">إدارة العقارات المميزة</h4>
          <p class="text-muted mb-4">يمكنك هنا تحديد العقارات التي تريد تمييزها وإعطائها أولوية الظهور</p>
          
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title mb-3"><i class="bi bi-star-fill text-warning me-2"></i> مميزات العقارات المميزة</h5>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item bg-transparent"><i class="bi bi-check2-circle text-success me-2"></i> تظهر في أعلى قائمة العقارات</li>
                    <li class="list-group-item bg-transparent"><i class="bi bi-check2-circle text-success me-2"></i> تحتوي على شارة "مميز" بارزة</li>
                    <li class="list-group-item bg-transparent"><i class="bi bi-check2-circle text-success me-2"></i> تأثيرات بصرية جذابة</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title mb-3"><i class="bi bi-trophy-fill text-purple me-2"></i> مميزات العروض الحصرية</h5>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item bg-transparent"><i class="bi bi-check2-circle text-success me-2"></i> شارة "عرض حصري" مميزة</li>
                    <li class="list-group-item bg-transparent"><i class="bi bi-check2-circle text-success me-2"></i> ظهور متميز في الموقع</li>
                    <li class="list-group-item bg-transparent"><i class="bi bi-check2-circle text-success me-2"></i> تصميم فريد يجذب الانتباه</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>العنوان</th>
                  <th>النوع</th>
                  <th>السعر</th>
                  <th>الحي</th>
                  <th>التمييز</th>
                </tr>
              </thead>
              <tbody id="featuredPropertiesTableBody">
                <!-- سيتم إضافة الصفوف ديناميكيًا -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- الفوتر -->
  <footer class="footer">
    <div class="container footer-container">
      <div class="row">
        <div class="col-md-4 footer-col">
          <h4>عن منصة عقارك</h4>
          <p>نحن منصة رائدة في مجال التسويق العقاري في الطائف، نهدف لتوفير خدمات عقارية متكاملة وموثوقة للباحثين عن عقارات مميزة.</p>
          <div class="footer-social">
            <a href="#" class="social-icon"><i class="bi bi-facebook"></i></a>
            <a href="#" class="social-icon"><i class="bi bi-twitter"></i></a>
            <a href="#" class="social-icon"><i class="bi bi-instagram"></i></a>
            <a href="#" class="social-icon"><i class="bi bi-whatsapp"></i></a>
          </div>
        </div>
        <div class="col-md-4 footer-col">
          <h4>روابط سريعة</h4>
          <ul class="footer-links">
            <li><a href="#"><i class="bi bi-chevron-left"></i> الرئيسية</a></li>
            <li><a href="#"><i class="bi bi-chevron-left"></i> عقارات للبيع</a></li>
            <li><a href="#"><i class="bi bi-chevron-left"></i> عقارات للإيجار</a></li>
            <li><a href="#"><i class="bi bi-chevron-left"></i> المشاريع العقارية</a></li>
            <li><a href="#"><i class="bi bi-chevron-left"></i> اتصل بنا</a></li>
          </ul>
        </div>
        <div class="col-md-4 footer-col">
          <h4>تواصل معنا</h4>
          <ul class="footer-links">
            <li><i class="bi bi-geo-alt"></i> الطائف، المملكة العربية السعودية</li>
            <li><i class="bi bi-telephone"></i> +966 53 534 2404</li>
            <li><i class="bi bi-envelope"></i> info@aqarak-taif.com</li>
            <li><i class="bi bi-clock"></i> نعمل طوال أيام الأسبوع: 9 صباحًا - 9 مساءً</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2023 منصة عقارك. جميع الحقوق محفوظة.</p>
      </div>
    </div>
  </footer>

  <!-- Bootstrap Bundle مع Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, deleteDoc, query, orderBy, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-auth.js";

    // دالة للتحقق من اختيار "أخرى" في الأحياء وإظهار حقل إدخال نص
    function checkOtherDistrict() {
      const districtSelect = document.getElementById('propDistrict');
      const otherDistrictContainer = document.getElementById('otherDistrictContainer');
      
      if (districtSelect.value === 'other') {
        otherDistrictContainer.style.display = 'block';
      } else {
        otherDistrictContainer.style.display = 'none';
      }
    }
    
    // جعل الدالة متاحة عالمياً
    window.checkOtherDistrict = checkOtherDistrict;

    // Firebase كونفيغوريشن
    const firebaseConfig = {
      apiKey: "AIzaSyC9XWKGxoFhnJYBDVEMG6FQ4QuY_X5G5a4",
      authDomain: "taif-properties.firebaseapp.com",
      projectId: "taif-properties",
      storageBucket: "taif-properties.appspot.com",
      messagingSenderId: "723308144307",
      appId: "1:723308144307:web:1c41d64a92b39cebee9b11"
    };

    // تهيئة Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    // حالة المستخدم
    let isAdmin = false;

    // العناصر في الصفحة
    const loginToggle = document.getElementById('loginToggle');
    const loginPanel = document.getElementById('loginPanel');
    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');
    const searchToggle = document.getElementById('searchToggle');
    const searchBox = document.getElementById('searchBox');
    const advancedSearchToggle = document.getElementById('advancedSearchToggle');
    const advancedSearchOptions = document.getElementById('advancedSearchOptions');
    const searchForm = document.getElementById('searchForm');
    const addPropertyForm = document.getElementById('addPropertyForm');
    const addProjectForm = document.getElementById('addProjectForm');
    const propertyList = document.getElementById('propertyList');
    const loadingProperties = document.getElementById('loadingProperties');
    const propertiesTableBody = document.getElementById('propertiesTableBody');
    const featuredPropertiesTableBody = document.getElementById('featuredPropertiesTableBody');
    const categoryCards = document.querySelectorAll('.category-card');

    // تبديل لوحة تسجيل الدخول
    loginToggle.addEventListener('click', () => {
      if (isAdmin) {
        // تسجيل خروج
        signOut(auth).then(() => {
          isAdmin = false;
          adminPanel.style.display = 'none';
          loginToggle.innerHTML = '<i class="bi bi-person-fill"></i> تسجيل الدخول';
          alert('تم تسجيل الخروج بنجاح');
        }).catch((error) => {
          console.error('خطأ في تسجيل الخروج:', error);
        });
      } else {
        // فتح لوحة تسجيل الدخول
        loginPanel.style.display = loginPanel.style.display === 'none' ? 'block' : 'none';
      }
    });

    // تبديل البحث المتقدم
    advancedSearchToggle.addEventListener('click', () => {
      advancedSearchOptions.style.display = advancedSearchOptions.style.display === 'none' ? 'block' : 'none';
      advancedSearchToggle.innerHTML = advancedSearchOptions.style.display === 'none' ? 
        '<i class="bi bi-plus-circle"></i> خيارات متقدمة' : 
        '<i class="bi bi-dash-circle"></i> إخفاء الخيارات المتقدمة';
    });

    // فلترة بطاقات الفئات
    categoryCards.forEach(card => {
      card.addEventListener('click', () => {
        // إزالة الكلاس النشط من جميع البطاقات
        categoryCards.forEach(c => c.classList.remove('active'));
        
        // إضافة الكلاس النشط للبطاقة المحددة
        card.classList.add('active');
        
        // فلترة العقارات
        const category = card.getAttribute('data-category');
        filterProperties(category);
      });
    });

    // تسجيل الدخول
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      // التحقق من بيانات الدخول - للتبسيط، نستخدم قيمة ثابتة
      if (username === "admin" && password === "12345") {
        try {
          // تم تسجيل الدخول بنجاح
          loginPanel.style.display = 'none';
          adminPanel.style.display = 'block';
          loginToggle.innerHTML = '<i class="bi bi-box-arrow-right"></i> تسجيل خروج';
          isAdmin = true;
          
          // تحميل العقارات لجدول الإدارة
          loadPropertiesTable();
          loadFeaturedPropertiesTable();
          
          alert('تم تسجيل الدخول بنجاح! مرحبًا بك في لوحة التحكم.');
        } catch (error) {
          console.error('خطأ في تسجيل الدخول:', error);
          alert('خطأ في تسجيل الدخول، يرجى التحقق من اسم المستخدم وكلمة المرور.');
        }
      } else {
        alert('خطأ في تسجيل الدخول، يرجى التحقق من اسم المستخدم وكلمة المرور.\n\nتلميح: اسم المستخدم: admin، كلمة المرور: 12345');
      }
    });

    // إضافة عقار جديد
    addPropertyForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!isAdmin) {
        alert('يجب تسجيل الدخول أولاً!');
        return;
      }
      
      const propertyData = {
        title: document.getElementById('propTitle').value,
        type: document.getElementById('propType').value,
        purpose: document.getElementById('propPurpose').value,
        price: Number(document.getElementById('propPrice').value),
        district: document.getElementById('propDistrict').value,
        area: Number(document.getElementById('propArea').value),
        bedrooms: document.getElementById('propBedrooms').value || null,
        bathrooms: document.getElementById('propBathrooms').value || null,
        image: document.getElementById('propImage').value,
        description: document.getElementById('propDescription').value,
        contact: document.getElementById('propContact').value,
        whatsapp: document.getElementById('propWhatsapp').value || null,
        isNew: document.getElementById('propIsNew').checked,
        featured: false,
        exclusive: false,
        createdAt: serverTimestamp()
      };
      
      try {
        const docRef = await addDoc(collection(db, "properties"), propertyData);
        console.log("تمت إضافة العقار بنجاح. معرّف: ", docRef.id);
        
        // إعادة ضبط النموذج
        addPropertyForm.reset();
        
        // إعادة تحميل العقارات
        loadProperties();
        loadPropertiesTable();
        
        alert('تمت إضافة العقار بنجاح!');
      } catch (error) {
        console.error("خطأ في إضافة العقار: ", error);
        alert('حدث خطأ أثناء إضافة العقار، يرجى المحاولة مرة أخرى.');
      }
    });

    // إضافة مشروع عقاري جديد
    addProjectForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!isAdmin) {
        alert('يجب تسجيل الدخول أولاً!');
        return;
      }
      
      const projectData = {
        title: document.getElementById('projectTitle').value,
        developer: document.getElementById('projectDeveloper').value,
        location: document.getElementById('projectLocation').value,
        type: document.getElementById('projectType').value,
        units: Number(document.getElementById('projectUnits').value),
        startPrice: Number(document.getElementById('projectStartPrice').value),
        image: document.getElementById('projectImage').value,
        description: document.getElementById('projectDescription').value,
        status: document.getElementById('projectStatus').value,
        completionDate: document.getElementById('projectCompletionDate').value || null,
        contact: document.getElementById('projectContact').value,
        website: document.getElementById('projectWebsite').value || null,
        featured: false,
        createdAt: serverTimestamp()
      };
      
      try {
        const docRef = await addDoc(collection(db, "projects"), projectData);
        console.log("تمت إضافة المشروع بنجاح. معرّف: ", docRef.id);
        
        // إعادة ضبط النموذج
        addProjectForm.reset();
        
        // إعادة تحميل العقارات
        loadProperties();
        
        alert('تمت إضافة المشروع بنجاح!');
      } catch (error) {
        console.error("خطأ في إضافة المشروع: ", error);
        alert('حدث خطأ أثناء إضافة المشروع، يرجى المحاولة مرة أخرى.');
      }
    });

    // تحميل العقارات
    async function loadProperties() {
      try {
        loadingProperties.style.display = 'block';
        propertyList.innerHTML = '';
        
        const q = query(collection(db, "properties"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        
        // العقارات المميزة أولاً
        let featuredProperties = [];
        let normalProperties = [];
        
        querySnapshot.forEach((doc) => {
          const property = { id: doc.id, ...doc.data() };
          
          if (property.featured) {
            featuredProperties.push(property);
          } else {
            normalProperties.push(property);
          }
        });
        
        // دمج العقارات المميزة مع العادية (المميزة في البداية)
        const allProperties = [...featuredProperties, ...normalProperties];
        
        // تحميل المشاريع العقارية
        const projectsQuery = query(collection(db, "projects"), orderBy("createdAt", "desc"));
        const projectsSnapshot = await getDocs(projectsQuery);
        
        projectsSnapshot.forEach((doc) => {
          const project = { id: doc.id, ...doc.data(), isProject: true };
          allProperties.push(project);
        });
        
        if (allProperties.length === 0) {
          propertyList.innerHTML = '<div class="col-12 text-center py-5"><p>لا توجد عقارات متاحة حاليًا.</p></div>';
        } else {
          allProperties.forEach(property => {
            propertyList.appendChild(createPropertyCard(property));
          });
        }
        
        // تحديث عدد العقارات
        document.querySelector('.properties-count').textContent = `${allProperties.length} عقار`;
        
        loadingProperties.style.display = 'none';
      } catch (error) {
        console.error("خطأ في تحميل العقارات: ", error);
        loadingProperties.innerHTML = '<p class="text-danger">حدث خطأ أثناء تحميل العقارات، يرجى المحاولة مرة أخرى.</p>';
      }
    }

    // تحميل جدول العقارات للإدارة
    async function loadPropertiesTable() {
      if (!isAdmin) return;
      
      try {
        propertiesTableBody.innerHTML = '';
        
        const q = query(collection(db, "properties"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        
        querySnapshot.forEach((doc) => {
          const property = doc.data();
          const date = property.createdAt ? new Date(property.createdAt.seconds * 1000) : new Date();
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${property.title}</td>
            <td>${getPropertyTypeText(property.type)}</td>
            <td>${property.price.toLocaleString()} ريال</td>
            <td>${getDistrictText(property.district)}</td>
            <td>${date.toLocaleDateString('ar-SA')}</td>
            <td>
              <button class="btn btn-sm btn-primary edit-property" data-id="${doc.id}">تعديل</button>
              <button class="btn btn-sm btn-danger delete-property" data-id="${doc.id}">حذف</button>
            </td>
          `;
          
          propertiesTableBody.appendChild(row);
        });
        
        // إضافة المستمعين للأحداث
        document.querySelectorAll('.edit-property').forEach(button => {
          button.addEventListener('click', (e) => {
            const propertyId = e.target.getAttribute('data-id');
            editProperty(propertyId);
          });
        });
        
        document.querySelectorAll('.delete-property').forEach(button => {
          button.addEventListener('click', (e) => {
            const propertyId = e.target.getAttribute('data-id');
            if (confirm('هل أنت متأكد من حذف هذا العقار؟')) {
              deleteProperty(propertyId);
            }
          });
        });
        
      } catch (error) {
        console.error("خطأ في تحميل جدول العقارات: ", error);
      }
    }

    // تحميل جدول العقارات المميزة
    async function loadFeaturedPropertiesTable() {
      if (!isAdmin) return;
      
      try {
        featuredPropertiesTableBody.innerHTML = '';
        
        const q = query(collection(db, "properties"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        
        querySnapshot.forEach((doc) => {
          const property = doc.data();
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${property.title}</td>
            <td>${getPropertyTypeText(property.type)}</td>
            <td>${property.price.toLocaleString()} ريال</td>
            <td>${getDistrictText(property.district)}</td>
            <td>
              <div class="d-flex flex-column gap-2">
                <div class="form-check form-switch">
                  <input class="form-check-input toggle-featured" type="checkbox" ${property.featured ? 'checked' : ''} data-id="${doc.id}">
                  <label class="form-check-label">
                    <span class="badge bg-danger rounded-pill ms-1">
                      <i class="bi bi-star-fill me-1"></i>
                    </span>
                    مميز
                  </label>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input toggle-exclusive" type="checkbox" ${property.exclusive ? 'checked' : ''} data-id="${doc.id}">
                  <label class="form-check-label">
                    <span class="badge bg-purple rounded-pill ms-1">
                      <i class="bi bi-trophy-fill me-1"></i>
                    </span>
                    عرض حصري
                  </label>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input toggle-new" type="checkbox" ${property.isNew ? 'checked' : ''} data-id="${doc.id}">
                  <label class="form-check-label">
                    <span class="badge bg-success rounded-pill ms-1">
                      <i class="bi bi-patch-check-fill me-1"></i>
                    </span>
                    جديد
                  </label>
                </div>
              </div>
            </td>
          `;
          
          featuredPropertiesTableBody.appendChild(row);
        });
        
        // إضافة المستمعين للأحداث
        document.querySelectorAll('.toggle-featured').forEach(checkbox => {
          checkbox.addEventListener('change', async (e) => {
            const propertyId = e.target.getAttribute('data-id');
            const isFeatured = e.target.checked;
            
            try {
              await updateDoc(doc(db, "properties", propertyId), {
                featured: isFeatured
              });
              
              console.log(`تم تحديث حالة التمييز للعقار ${propertyId} إلى ${isFeatured}`);
              // إعادة تحميل العقارات
              loadProperties();
            } catch (error) {
              console.error("خطأ في تحديث حالة التمييز: ", error);
              alert('حدث خطأ أثناء تحديث حالة التمييز، يرجى المحاولة مرة أخرى.');
              // إعادة ضبط حالة الـ checkbox
              e.target.checked = !isFeatured;
            }
          });
        });
        
        document.querySelectorAll('.toggle-exclusive').forEach(checkbox => {
          checkbox.addEventListener('change', async (e) => {
            const propertyId = e.target.getAttribute('data-id');
            const isExclusive = e.target.checked;
            
            try {
              await updateDoc(doc(db, "properties", propertyId), {
                exclusive: isExclusive
              });
              
              console.log(`تم تحديث حالة الحصرية للعقار ${propertyId} إلى ${isExclusive}`);
              // إعادة تحميل العقارات
              loadProperties();
            } catch (error) {
              console.error("خطأ في تحديث حالة الحصرية: ", error);
              alert('حدث خطأ أثناء تحديث حالة الحصرية، يرجى المحاولة مرة أخرى.');
              // إعادة ضبط حالة الـ checkbox
              e.target.checked = !isExclusive;
            }
          });
        });
        
        document.querySelectorAll('.toggle-new').forEach(checkbox => {
          checkbox.addEventListener('change', async (e) => {
            const propertyId = e.target.getAttribute('data-id');
            const isNew = e.target.checked;
            
            try {
              await updateDoc(doc(db, "properties", propertyId), {
                isNew: isNew
              });
              
              console.log(`تم تحديث حالة الجديد للعقار ${propertyId} إلى ${isNew}`);
              // إعادة تحميل العقارات
              loadProperties();
            } catch (error) {
              console.error("خطأ في تحديث حالة الجديد: ", error);
              alert('حدث خطأ أثناء تحديث حالة الجديد، يرجى المحاولة مرة أخرى.');
              // إعادة ضبط حالة الـ checkbox
              e.target.checked = !isNew;
            }
          });
        });
        
      } catch (error) {
        console.error("خطأ في تحميل جدول العقارات المميزة: ", error);
      }
    }

    // إنشاء بطاقة عقار
    function createPropertyCard(property) {
      const col = document.createElement('div');
      col.className = 'col-md-6 col-lg-4 mb-4 fade-in';
      
      // محتوى مختلف للمشاريع العقارية
      if (property.isProject) {
        col.innerHTML = `
          <div class="property-card ${property.featured ? 'featured-property' : ''} ${property.exclusive ? 'exclusive-property' : ''}">
            <div class="property-image-container">
              <img src="${property.image}" alt="${property.title}" class="property-image">
              <div class="property-badges">
                ${property.featured ? '<span class="property-badge featured">مميز</span>' : ''}
                <span class="property-badge">${getProjectTypeText(property.type)}</span>
              </div>
              <div class="property-type">
                <p class="property-type-label">مشروع عقاري</p>
                <p class="property-price">يبدأ من ${property.startPrice.toLocaleString()} ريال</p>
              </div>
            </div>
            <div class="property-content">
              <h3 class="property-title">${property.title}</h3>
              <p class="property-location">
                <i class="bi bi-geo-alt-fill"></i>
                ${getDistrictText(property.location)}
              </p>
              <p class="property-description">${property.description}</p>
              <div class="property-features">
                <div class="property-feature">
                  <div class="property-feature-icon">
                    <i class="bi bi-buildings"></i>
                  </div>
                  <span class="property-feature-text">${property.units}</span>
                  <span>وحدة</span>
                </div>
                <div class="property-feature">
                  <div class="property-feature-icon">
                    <i class="bi bi-person-check"></i>
                  </div>
                  <span class="property-feature-text">${getProjectStatusText(property.status)}</span>
                </div>
              </div>
            </div>
            <div class="property-footer">
              <span class="property-age">المطور: ${property.developer}</span>
              <div class="property-contact">
                <button class="whatsapp-btn" onclick="window.open('https://wa.me/0535342404?text=مرحبا، أنا مهتم بالعقار: ${property.title} - ${getProjectTypeText(property.type)}', '_blank')">
                  <i class="bi bi-whatsapp"></i>
                </button>
                <button class="call-btn" onclick="window.open('tel:0535342404', '_blank')">
                  <i class="bi bi-telephone"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      } else {
        // بطاقة العقار العادي
        col.innerHTML = `
          <div class="property-card ${property.featured ? 'featured-property' : ''} ${property.exclusive ? 'exclusive-property' : ''}">
            <div class="property-image-container">
              <img src="${property.image}" alt="${property.title}" class="property-image">
              <div class="property-badges">
                ${property.featured ? '<span class="property-badge featured">مميز</span>' : ''}
                ${property.exclusive ? '<span class="property-badge exclusive">عرض حصري</span>' : ''}
                ${property.isNew ? '<span class="property-badge new">جديد</span>' : ''}
                <span class="property-badge ${property.purpose === 'sale' ? 'sale' : 'rent'}">${property.purpose === 'sale' ? 'للبيع' : 'للإيجار'}</span>
              </div>
              <div class="property-type">
                <p class="property-type-label">${getPropertyTypeText(property.type)}</p>
                <p class="property-price">${property.price.toLocaleString()} ${property.purpose === 'rent' ? 'ريال/شهر' : 'ريال'}</p>
              </div>
            </div>
            <div class="property-content">
              <h3 class="property-title">${property.title}</h3>
              <p class="property-location">
                <i class="bi bi-geo-alt-fill"></i>
                ${getDistrictText(property.district)}
              </p>
              <p class="property-description">${property.description}</p>
              <div class="property-features">
                ${property.bedrooms ? `
                  <div class="property-feature">
                    <div class="property-feature-icon">
                      <i class="bi bi-door-open"></i>
                    </div>
                    <span class="property-feature-text">${property.bedrooms}</span>
                    <span>غرف</span>
                  </div>
                ` : ''}
                
                ${property.bathrooms ? `
                  <div class="property-feature">
                    <div class="property-feature-icon">
                      <i class="bi bi-droplet"></i>
                    </div>
                    <span class="property-feature-text">${property.bathrooms}</span>
                    <span>حمامات</span>
                  </div>
                ` : ''}
                
                <div class="property-feature">
                  <div class="property-feature-icon">
                    <i class="bi bi-rulers"></i>
                  </div>
                  <span class="property-feature-text">${property.area}</span>
                  <span>م²</span>
                </div>
              </div>
            </div>
            <div class="property-footer">
              <span class="property-age">
                ${getRelativeTime(property.createdAt ? new Date(property.createdAt.seconds * 1000) : new Date())}
              </span>
              <div class="property-contact">
                <button class="whatsapp-btn" onclick="window.open('https://wa.me/0535342404?text=مرحبا، أنا مهتم بالعقار: ${property.title} - ${getPropertyTypeText(property.type)} - ${property.purpose === 'sale' ? 'للبيع' : 'للإيجار'} - بسعر ${property.price.toLocaleString()} ريال', '_blank')">
                  <i class="bi bi-whatsapp"></i>
                </button>
                <button class="call-btn" onclick="window.open('tel:0535342404', '_blank')">
                  <i class="bi bi-telephone"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      }
      
      return col;
    }

    // فلترة العقارات
    function filterProperties(category) {
      const propertyCards = document.querySelectorAll('#propertyList > div');
      
      if (category === 'all') {
        propertyCards.forEach(card => {
          card.style.display = 'block';
        });
        return;
      }
      
      propertyCards.forEach(card => {
        const propertyType = card.querySelector('.property-type-label').textContent.trim();
        
        if (category === 'project' && propertyType === 'مشروع عقاري') {
          card.style.display = 'block';
        } else if (
          (category === 'apartment' && propertyType === 'شقة') ||
          (category === 'villa' && propertyType === 'فيلا') ||
          (category === 'land' && propertyType === 'أرض') ||
          (category === 'commercial' && propertyType === 'تجاري') ||
          (category === 'farm' && propertyType === 'مزرعة')
        ) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }

    // تحرير عقار
    async function editProperty(propertyId) {
      try {
        const docSnap = await getDoc(doc(db, "properties", propertyId));
        
        if (docSnap.exists()) {
          const property = docSnap.data();
          
          // تعبئة بيانات النموذج
          document.getElementById('propTitle').value = property.title;
          document.getElementById('propType').value = property.type;
          document.getElementById('propPurpose').value = property.purpose;
          document.getElementById('propPrice').value = property.price;
          document.getElementById('propDistrict').value = property.district;
          document.getElementById('propArea').value = property.area;
          document.getElementById('propBedrooms').value = property.bedrooms || '';
          document.getElementById('propBathrooms').value = property.bathrooms || '';
          document.getElementById('propImage').value = property.image;
          document.getElementById('propDescription').value = property.description;
          document.getElementById('propContact').value = property.contact;
          document.getElementById('propWhatsapp').value = property.whatsapp || '';
          document.getElementById('propIsNew').checked = property.isNew;
          
          // تغيير زر الإرسال
          const submitButton = addPropertyForm.querySelector('button[type="submit"]');
          submitButton.innerHTML = '<i class="bi bi-check-circle"></i> تحديث العقار';
          submitButton.classList.remove('btn-success');
          submitButton.classList.add('btn-primary');
          
          // إضافة معرّف العقار للنموذج
          const propertyIdInput = document.createElement('input');
          propertyIdInput.type = 'hidden';
          propertyIdInput.id = 'propertyId';
          propertyIdInput.value = propertyId;
          addPropertyForm.appendChild(propertyIdInput);
          
          // تغيير مستمع حدث النموذج
          addPropertyForm.removeEventListener('submit', addPropertySubmitHandler);
          addPropertyForm.addEventListener('submit', updatePropertySubmitHandler);
          
          // عرض علامة التبويب
          const addPropertyTab = document.getElementById('add-property-tab');
          addPropertyTab.click();
          
          // تمرير إلى النموذج
          addPropertyForm.scrollIntoView({ behavior: 'smooth' });
        } else {
          console.error("لا يوجد عقار بهذا المعرّف!");
          alert('لا يوجد عقار بهذا المعرّف!');
        }
      } catch (error) {
        console.error("خطأ في جلب بيانات العقار: ", error);
        alert('حدث خطأ أثناء جلب بيانات العقار، يرجى المحاولة مرة أخرى.');
      }
    }

    // حذف عقار
    async function deleteProperty(propertyId) {
      try {
        await deleteDoc(doc(db, "properties", propertyId));
        console.log("تم حذف العقار بنجاح!");
        
        // إعادة تحميل العقارات
        loadProperties();
        loadPropertiesTable();
        loadFeaturedPropertiesTable();
        
        alert('تم حذف العقار بنجاح!');
      } catch (error) {
        console.error("خطأ في حذف العقار: ", error);
        alert('حدث خطأ أثناء حذف العقار، يرجى المحاولة مرة أخرى.');
      }
    }

    // مستمع حدث تحديث العقار
    async function updatePropertySubmitHandler(e) {
      e.preventDefault();
      
      if (!isAdmin) {
        alert('يجب تسجيل الدخول أولاً!');
        return;
      }
      
      const propertyId = document.getElementById('propertyId').value;
      
      const propertyData = {
        title: document.getElementById('propTitle').value,
        type: document.getElementById('propType').value,
        purpose: document.getElementById('propPurpose').value,
        price: Number(document.getElementById('propPrice').value),
        district: document.getElementById('propDistrict').value,
        area: Number(document.getElementById('propArea').value),
        bedrooms: document.getElementById('propBedrooms').value || null,
        bathrooms: document.getElementById('propBathrooms').value || null,
        image: document.getElementById('propImage').value,
        description: document.getElementById('propDescription').value,
        contact: document.getElementById('propContact').value,
        whatsapp: document.getElementById('propWhatsapp').value || null,
        isNew: document.getElementById('propIsNew').checked,
        updatedAt: serverTimestamp()
      };
      
      try {
        await updateDoc(doc(db, "properties", propertyId), propertyData);
        console.log("تم تحديث العقار بنجاح!");
        
        // إعادة ضبط النموذج
        addPropertyForm.reset();
        
        // إزالة معرّف العقار من النموذج
        const propertyIdInput = document.getElementById('propertyId');
        if (propertyIdInput) {
          propertyIdInput.remove();
        }
        
        // إعادة تهيئة زر الإرسال
        const submitButton = addPropertyForm.querySelector('button[type="submit"]');
        submitButton.innerHTML = '<i class="bi bi-plus-circle"></i> إضافة العقار';
        submitButton.classList.remove('btn-primary');
        submitButton.classList.add('btn-success');
        
        // إعادة تعيين مستمع حدث النموذج
        addPropertyForm.removeEventListener('submit', updatePropertySubmitHandler);
        addPropertyForm.addEventListener('submit', addPropertySubmitHandler);
        
        // إعادة تحميل العقارات
        loadProperties();
        loadPropertiesTable();
        loadFeaturedPropertiesTable();
        
        alert('تم تحديث العقار بنجاح!');
      } catch (error) {
        console.error("خطأ في تحديث العقار: ", error);
        alert('حدث خطأ أثناء تحديث العقار، يرجى المحاولة مرة أخرى.');
      }
    }

    // تحويل رقم الهاتف إلى الصيغة الدولية
    function formatPhone(phone) {
      // إزالة أي أحرف غير رقمية
      let cleaned = phone.replace(/\D/g, '');
      
      // إذا كان الرقم يبدأ بـ 0، استبدله بـ 966
      if (cleaned.startsWith('0')) {
        cleaned = '966' + cleaned.slice(1);
      }
      
      // إذا لم يكن يبدأ بـ +، أضف ذلك
      if (!cleaned.startsWith('966')) {
        cleaned = '966' + cleaned;
      }
      
      return cleaned;
    }

    // الحصول على نص نوع العقار
    function getPropertyTypeText(type) {
      const types = {
        'apartment': 'شقة',
        'villa': 'فيلا',
        'land': 'أرض',
        'commercial': 'تجاري',
        'farm': 'مزرعة'
      };
      
      return types[type] || type;
    }

    // الحصول على نص نوع المشروع
    function getProjectTypeText(type) {
      const types = {
        'residential': 'سكني',
        'commercial': 'تجاري',
        'mixed': 'متعدد الاستخدامات'
      };
      
      return types[type] || type;
    }

    // الحصول على نص حالة المشروع
    function getProjectStatusText(status) {
      const statuses = {
        'planned': 'تخطيط',
        'underConstruction': 'قيد الإنشاء',
        'completed': 'مكتمل'
      };
      
      return statuses[status] || status;
    }

    // الحصول على نص الحي
    function getDistrictText(district) {
      const districts = {
        'shifa': 'الشفا',
        'radf': 'الردف',
        'faisaliah': 'الفيصلية',
        'hawiyah': 'الحوية',
        'salamah': 'السلامة',
        'nakheel': 'النخيل',
        'wahaPlaza': 'واحة الطائف',
        'qimatTaif': 'قمة الطائف',
        'rayyan': 'الريان',
        'masarrah': 'المسرة',
        'other': 'أخرى'
      };
      
      // إذا كان العقار يحتوي على حقل districtText، استخدمه مباشرة
      if (typeof district === 'object' && district.district) {
        if (district.districtText) {
          return district.districtText;
        }
        return districts[district.district] || district.district;
      }
      
      // خاص بالعقارات التي تم إضافتها من خلال "أخرى"
      if (district === 'other' && arguments.length > 1 && arguments[1] && arguments[1].districtText) {
        return arguments[1].districtText;
      }
      
      // للعقارات القديمة التي تم حفظها قبل التعديل
      return districts[district] || district;
    }

    // الحصول على الوقت النسبي
    function getRelativeTime(date) {
      const now = new Date();
      const diff = now - date;
      
      // ثواني
      const seconds = Math.floor(diff / 1000);
      if (seconds < 60) {
        return 'منذ ' + seconds + ' ثانية';
      }
      
      // دقائق
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) {
        return 'منذ ' + minutes + ' دقيقة';
      }
      
      // ساعات
      const hours = Math.floor(minutes / 60);
      if (hours < 24) {
        return 'منذ ' + hours + ' ساعة';
      }
      
      // أيام
      const days = Math.floor(hours / 24);
      if (days < 30) {
        return 'منذ ' + days + ' يوم';
      }
      
      // شهور
      const months = Math.floor(days / 30);
      if (months < 12) {
        return 'منذ ' + months + ' شهر';
      }
      
      // سنوات
      const years = Math.floor(months / 12);
      return 'منذ ' + years + ' سنة';
    }

    // مستمع حدث حالة تسجيل الدخول
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // المستخدم قد سجل الدخول
        isAdmin = true;
        adminPanel.style.display = 'block';
        loginPanel.style.display = 'none';
        loginToggle.innerHTML = '<i class="bi bi-box-arrow-right"></i> تسجيل خروج';
        
        // تحميل العقارات لجدول الإدارة
        loadPropertiesTable();
        loadFeaturedPropertiesTable();
      } else {
        // المستخدم غير مسجل
        isAdmin = false;
        adminPanel.style.display = 'none';
        loginToggle.innerHTML = '<i class="bi bi-person-fill"></i> تسجيل الدخول';
      }
    });

    // مستمع حدث إضافة العقار
    const addPropertySubmitHandler = async (e) => {
      e.preventDefault();
      
      if (!isAdmin) {
        alert('يجب تسجيل الدخول أولاً!');
        return;
      }
      
      // التحقق من قيمة الحي ومعالجة خيار "أخرى"
      let districtValue = document.getElementById('propDistrict').value;
      let districtText = '';
      
      if (districtValue === 'other') {
        districtText = document.getElementById('otherDistrict').value;
        if (!districtText.trim()) {
          alert('يرجى إدخال اسم الحي في حقل "أخرى"');
          return;
        }
      } else {
        // الحصول على النص المعروض بدلاً من القيمة
        const districtSelect = document.getElementById('propDistrict');
        const selectedOption = districtSelect.options[districtSelect.selectedIndex];
        districtText = selectedOption.text;
      }
      
      // التحقق من صحة الصورة
      const imageUrl = document.getElementById('propImage').value;
      if (!imageUrl || !imageUrl.trim()) {
        alert('رابط الصورة مطلوب');
        return;
      }
      
      const propertyData = {
        title: document.getElementById('propTitle').value,
        type: document.getElementById('propType').value,
        purpose: document.getElementById('propPurpose').value,
        price: Number(document.getElementById('propPrice').value),
        district: districtValue,
        districtText: districtText, // إضافة اسم الحي كنص
        area: Number(document.getElementById('propArea').value),
        bedrooms: document.getElementById('propBedrooms').value || null,
        bathrooms: document.getElementById('propBathrooms').value || null,
        image: document.getElementById('propImage').value,
        description: document.getElementById('propDescription').value,
        contact: document.getElementById('propContact').value,
        whatsapp: document.getElementById('propWhatsapp').value || null,
        isNew: document.getElementById('propIsNew').checked,
        featured: false,
        exclusive: false,
        createdAt: serverTimestamp()
      };
      
      try {
        const docRef = await addDoc(collection(db, "properties"), propertyData);
        console.log("تمت إضافة العقار بنجاح. معرّف: ", docRef.id);
        
        // إعادة ضبط النموذج
        addPropertyForm.reset();
        
        // إعادة تحميل العقارات
        loadProperties();
        loadPropertiesTable();
        
        alert('تمت إضافة العقار بنجاح!');
      } catch (error) {
        console.error("خطأ في إضافة العقار: ", error);
        alert('حدث خطأ أثناء إضافة العقار، يرجى المحاولة مرة أخرى.');
      }
    };

    // إضافة مستمع حدث النموذج
    addPropertyForm.addEventListener('submit', addPropertySubmitHandler);

    // تحميل العقارات عند تحميل الصفحة
    window.addEventListener('DOMContentLoaded', () => {
      loadProperties();
    });

    // البحث عن العقارات
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      alert('تم تفعيل البحث. قريبًا سيتم تنفيذ هذه الميزة بالكامل!');
    });

    // تبديل ظهور البحث المتقدم
    searchToggle.addEventListener('click', () => {
      searchBox.style.display = searchBox.style.display === 'none' || searchBox.style.display === '' ? 'block' : 'none';
    });

  </script>
</body>
</html>